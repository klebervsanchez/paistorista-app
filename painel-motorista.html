<!-- painel-motorista.html -->
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Painel do Motorista</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>
</head>
<body class="grey lighten-4">

  <nav class="blue darken-2">
    <div class="nav-wrapper container">
      <a href="#!" class="brand-logo">ðŸš˜ Minhas Caronas</a>
      <ul class="right">
        <li><a href="app.html" class="btn orange">Voltar</a></li>
        <li><button id="btn-logout" class="btn red">Sair</button></li>
      </ul>
    </div>
  </nav>

  <main class="container">
    <h5 class="blue-text text-darken-2">Caronas Ativas</h5>
    <ul id="active-rides" class="collection z-depth-1"></ul>

    <h5 class="blue-text text-darken-2">HistÃ³rico de Caronas</h5>
    <ul id="ride-history" class="collection z-depth-1"></ul>
  </main>

  <script src="firebase-config.js"></script>
  <script>
    firebase.auth().onAuthStateChanged(user => {
      if (!user) return (window.location.href = "login.html");

      const db = firebase.firestore();

      // ðŸ”µ Caronas ativas
      db.collection("caronas")
        .where("uid", "==", user.uid)
        .where("status", "==", "ativa")
        .onSnapshot(snapshot => {
          const list = document.getElementById("active-rides");
          list.innerHTML = "";
          snapshot.forEach(doc => {
            const c = doc.data();
            const li = document.createElement("li");
            li.className = "collection-item";
            li.innerHTML = `
              <strong>${c.escola}</strong> (${c.vagasDisponiveis}/${c.vagas} vagas)<br>
              Origem: ${c.origem}<br>
              Destino: ${c.destino}<br>
              <small>${c.solicitacoes?.length || 0} solicitaÃ§Ã£o(Ãµes)</small>
              <br>
              <button class="btn-small blue" onclick="verSolicitacoes('${doc.id}')">Ver solicitaÃ§Ãµes</button>
            `;
            list.appendChild(li);
          });
        });

      // ðŸŸ¡ HistÃ³rico
      db.collection("caronas")
        .where("uid", "==", user.uid)
        .where("status", "==", "encerrada")
        .onSnapshot(snapshot => {
          const list = document.getElementById("ride-history");
          list.innerHTML = "";
          snapshot.forEach(doc => {
            const c = doc.data();
            const li = document.createElement("li");
            li.className = "collection-item grey lighten-3";
            li.innerHTML = `
              <strong>${c.escola}</strong> (Encerrada)<br>
              Origem: ${c.origem}<br>
              Destino: ${c.destino}<br>
              <small>${c.solicitacoes?.length || 0} passageiros</small>
            `;
            list.appendChild(li);
          });
        });
    });

    function verSolicitacoes(caronaId) {
      window.location.href = `solicitacoes.html?carona=${caronaId}`;
    }

    document.getElementById("btn-logout").addEventListener("click", () => {
      firebase.auth().signOut().then(() => (window.location.href = "login.html"));
    });
  </script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
</body>
</html>
